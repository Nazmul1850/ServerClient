.MODEL MEDIUM
.STACK 110H
.DATA  
M1 DB 'DIGIT=> ',0DH,0AH,'$'
M2 DB 0DH,0AH,'OPERATOR(+,-,*,/,q): $'
M3 DB 'SIGN1(ONLY '-' FOR NEGETIVE VALUE): ',0DH,0AH,'$'
M7 DB 'SIGN2(ONLY '-' FOR NEGETIVE VALUE): ',0DH,0AH,'$'
M4 DB 0DH,0AH,'$'
M5 DB 0DH,0AH,'WRONG OPERATOR $'
BO DB '[$'
BOS DB '[-$'
BC DB ']$'
BE DB ' = $'
D1 DW 0D
D2 DW 0D 
D3 DW 0D
D3Q DW 0D 
D1S DB 00H
D2S DB 00H
D3S DB 00H 
OPT DB ?

.CODE
MAIN PROC
    MOV AX,@DATA 
    MOV DS,AX 
    
    FIRST:
        MOV D1,0D
        MOV D2,0D
        MOV D3,0D 
        MOV D3Q,0D 
        MOV D1S,00H
        MOV D2S,00H
        MOV D3S,00H
        
        MOV AH,9
        LEA DX,M3
        INT 21H  
        
        MOV AH,1                 ;FOR FIRST SIGN
        INT 21H
        MOV BX,AX
        MOV BH,0D
        
        MOV AH,9
        LEA DX,M4
        INT 21H 
        
        CMP BL,2DH           
        JE  D1SIGN
        CALL INPUT
        MOV AX, D3
        MOV D1, AX 
        CALL OPERATOR
        JMP SECOND 
        
        D1SIGN:
            CALL INPUT
            MOV D1S,01H 
            NEG D3 
            MOV AX, D3
            MOV D1, AX 
            CALL OPERATOR
            JMP SECOND
    
    SECOND: 
        MOV D3,0D  
        
        MOV AH,9
        LEA DX,M4
        INT 21H 
        
        MOV AH,9
        LEA DX,M7
        INT 21H  
        
        MOV AH,1                 ;FOR FIRST SIGN
        INT 21H
        MOV BX,AX
        MOV BH,0D 
        
        MOV AH,9
        LEA DX,M4
        INT 21H
        
        CMP BL,2DH           
        JE  D2SIGN
        CALL INPUT
        MOV AX, D3
        MOV D2, AX
        JMP STARTCALC 
        
        D2SIGN:
            CALL INPUT
            MOV D2S,01H  
            NEG D3 
            MOV AX, D3
            MOV D2, AX
            JMP STARTCALC
     
     STARTCALC:
        CMP OPT,2BH
        JE SUM
        CMP OPT,2DH
        JE SUBTRACT
        CMP OPT,2AH
        JE MULTY
        CMP OPT,2FH
        JE DEVIDE
        
        SUM:
            CALL SUMCALC
            CALL PRINT
            JMP FIRST
        SUBTRACT:
            CALL SUBCALC
            CALL PRINT
            JMP FIRST
        MULTY:
            CALL MULCALC
            CALL PRINT 
            JMP FIRST
        DEVIDE:
            CALL DIVCALC 
            CALL PRINT 
            JMP FIRST
            
            
    EXIT:
    MOV AH,4CH
    INT 21H
ENDP MAIN

INPUT PROC 
    MOV AH,9                              ;INPUT PROCEDURE
    LEA DX,M1
    INT 21H
    
    
    WHILE:
        MOV AH,1
        INT 21H
        MOV BX,AX
        MOV BH,0D
        
        CMP AL,0DH
        JE END_WHILE
        JMP STARTCOMPARE 
        
         
        STARTCOMPARE:
            CMP BL,30H
            JNGE WHILE
            CMP BL,39H
            JG WHILE  
            
            SUB BX,30H
            MOV AX,D3
            MOV CX,10
            MUL CX
            ADD AX,BX
            
            MOV BX,AX
            MOV D3,BX
            
            JMP WHILE
        

    
    END_WHILE:
        RET
ENDP INPUT

OPERATOR PROC 
    MOV AH,9
    LEA DX,M2
    INT 21H
    MOV AH,1
    INT 21H                                              ;OPERATOR PROCEDURE
    MOV BL,AL
    MOV OPT,BL
    
    CMP OPT,2AH
    JE OK
    CMP OPT,2BH
    JE OK
    CMP OPT,2DH
    JE OK
    CMP OPT,2FH
    JE OK
    CMP OPT,71H
    JE FINISH
    
    MOV AH,9
    LEA DX,M5
    INT 21H 
    JMP EXIT
    
    OK:
      RET
    FINISH:
       JMP EXIT    
     
    
    RET
ENDP OPERATOR
   

SUMCALC PROC 
    MOV D3S,00H
    MOV AX,D1
    MOV BX,D2
    ADD AX,BX
    MOV D3,AX
    CMP D3,0D
    JGE POS
    MOV D3S,01H
    ;NEG D3 
    POS: 
    RET
ENDP SUMCALC
 
SUBCALC PROC
    MOV D3S,00H
    MOV AX,D1
    MOV BX,D2
    SUB AX,BX
    MOV D3,AX
    CMP D3,0D
    JGE POS1
    MOV D3S,01H
    ;NEG D3
    POS1:  
    RET
ENDP SUBCALC 

MULCALC PROC
    MOV D3S,00H
    MOV AX,D1
    MOV BX,D2
    MUL BX
    MOV D3,AX
    CMP D3,0D
    JGE POS2
    MOV D3S,01H
    ;NEG D3
    POS2:
    RET
ENDP MULCALC 

DIVCALC PROC
    MOV D3S,00H
    XOR AX,AX 
    MOV BX,AX
    MOV DX,AX
    MOV AX,D1
    MOV BX,D2
    CMP D1S,00H
    JE OTHER
    D1NEG:
        CMP D2S,00H
        JE D2POS
        JMP D2NEG
        D2POS:
            NEG AX
            NEG BX
            IDIV BX 
            MOV D3S,01H
            ;NEG D3
            JMP DIVEND 
        D2NEG:
            NEG AX 
            NEG BX
            IDIV BX
            MOV D3S,00H
            JMP DIVEND
    OTHER:
        CMP D2S,00H
        JE D2POS1
        JMP D2NEG1
        D2POS1:
            IDIV BX 
            MOV D3S,00H
            JMP DIVEND 
        D2NEG1:
            IDIV BX
            MOV D3S,01H
            JMP DIVEND
    DIVEND:   
        MOV D3,AX
        MOV D3Q,DX
        RET
ENDP DIVCALC

PRINT PROC
    MOV AH,9
    LEA DX,M4
    INT 21H
    FIRSTPRINT:
        CMP D1S,01H
        JE FIRSTNEG
        JMP FIRSTPOS
        FIRSTNEG:
            MOV AH,9
            LEA DX,BOS
            INT 21H 
            NEG D1
            MOV AX,D1
            CALL PRINTDATA
            MOV AH,9
            LEA DX,BC
            INT 21H 
            JMP  OPERATORPRINT
        FIRSTPOS:
            MOV AH,9
            LEA DX,BO
            INT 21H 
            MOV AX,D1
            CALL PRINTDATA
            MOV AH,9
            LEA DX,BC
            INT 21H   
           
    OPERATORPRINT:
            MOV AH,9
            LEA DX,BO
            INT 21H  
            MOV AH,2
            MOV DL,OPT
            INT 21H
            MOV AH,9
            LEA DX,BC
            INT 21H           
    SECONDPRINT:
        CMP D2S,01H
        JE SECONDNEG
        JMP SECONDPOS 
        SECONDNEG:
            MOV AH,9
            LEA DX,BOS
            INT 21H
            NEG D2  
            MOV AX,D2
            CALL PRINTDATA
            MOV AH,9
            LEA DX,BC
            INT 21H
            JMP EQUALPRINT    
        SECONDPOS:
            MOV AH,9
            LEA DX,BO
            INT 21H  
            MOV AX,D2
            CALL PRINTDATA
            MOV AH,9
            LEA DX,BC
            INT 21H  
    EQUALPRINT:
        MOV AH,9
        LEA DX,BE
        INT 21H
    RESULTPRINT:   
        CMP D3,0D
        JGE RESULTPOS
        JMP RESULTNEG
        RESULTNEG:
            MOV AH,9
            LEA DX,BOS
            INT 21H
            NEG D3
            MOV AX,D3
            CALL PRINTDATA
            MOV AH,9
            LEA DX,BC
            INT 21H 
            JMP RETURN     
        RESULTPOS:
            MOV AH,9
            LEA DX,BO
            INT 21H 
            MOV AX,D3
            CALL PRINTDATA
            MOV AH,9
            LEA DX,BC
            INT 21H  
    RETURN:
        MOV AH,9
        LEA DX,M4
        INT 21H   
    RET
ENDP PRINT

PRINTDATA PROC
    MOV CX,0 
    MOV DX,0 
    LABEL1:
        CMP AX,0
        JE PRINT1
        MOV BX,10         
        DIV BX                 
        PUSH DX               
        INC CX               
        XOR DX,DX 
        JMP LABEL1 
    PRINT1:
        CMP CX,0 
        JE FDATA
        POP DX 
        ADD DX,48 
        MOV AH,02H 
        INT 21H 
        DEC CX 
        JMP PRINT1 
    FDATA:
    
    RET                            
ENDP PRINTDATA
